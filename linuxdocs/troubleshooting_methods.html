

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Troubleshooting Methods &#8212; MerlinTechs</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Openstack Related Documentation" href="../openstackdocs/index.html" />
    <link rel="prev" title="Linux Related Documentation" href="index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../openstackdocs/index.html" title="Openstack Related Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Linux Related Documentation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MerlinTechs</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Linux Related Documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/monkey_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Troubleshooting Methods</a><ul>
<li><a class="reference internal" href="#troubleshooting-a-known-system-binary-search-style">Troubleshooting a Known System Binary Search Style</a></li>
<li><a class="reference internal" href="#troubleshooting-an-unknown-system-by-following-the-path">Troubleshooting an Unknown System by Following the Path</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Linux Related Documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../openstackdocs/index.html"
                        title="next chapter">Openstack Related Documentation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/linuxdocs/troubleshooting_methods.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="troubleshooting-methods">
<h1>Troubleshooting Methods<a class="headerlink" href="#troubleshooting-methods" title="Permalink to this headline">¶</a></h1>
<p>I have working on electronic and linux systems for about 20 years now.  I don’t
and never will claim to be an expert on anything due to the field being in
constant flux, but I have gotten “decent” at troubleshooting in general.  I have
always had trouble seeing things in my minds eye <a class="footnote-reference" href="#f1" id="id1">[1]</a> which leads to overall
memory issues, but allows me to not get lost in the details. When you are lost
in the details, you are not taking the essential step back to look at the bigger
picture needed for troubleshooting a system. And when it comes to electonics or
technology in general, that big picture is the communication path.</p>
<p>The communications path at its source is a flow of electrons. When working on
electronic systems in the army, that ment breaking out the oscope and placing a
probe into different test points along the path of electron flow to see if
everything before the probe is working as intended.  The same can be done with
most technology in general.  Instead of tracing the path of electrons with an
oscope or voltmeter, we are are using many tools and logs to “probe” points
along the path.  This allows us to see if its working up to that point or not.</p>
<p>The essense of troubleshooting most systems is knowing the communication path
and ruling out sections of the path by “probing” a point along it.  So how do
you know where to probe?  I usually go by one of two methods depending on how
much I know the system’s communication path. If you know the system, a
binary searchy <a class="footnote-reference" href="#f2" id="id2">[2]</a> is a good way to quickly get to the root of the issue. If
you do not know the system, start from the beginning and follow the
communication path.</p>
<div class="section" id="troubleshooting-a-known-system-binary-search-style">
<h2>Troubleshooting a Known System Binary Search Style<a class="headerlink" href="#troubleshooting-a-known-system-binary-search-style" title="Permalink to this headline">¶</a></h2>
<p>So lets say that you get a call and a client can’t access their web page. In
this scenario, you know the system and its communication paths. For the sake
of this section, lets say it looks something like this.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>client browser &lt;=&gt; dc router &lt;=&gt; dc switch &lt;=&gt; haproxy load balancer &lt;=&gt; multiple nginx webheads &lt;=&gt; multiple php-fpm app servers &lt;=&gt; db
</pre></div>
</div>
<p>You have no idea where in that path the issue is occuring.  The path between
each component is a good probe point, but where do you start? You could start
from the beginning and waste a lot of time checking each point along the path.
The better approach is to pick a good point in the middle.  In this case in
between the switch and the haproxy load balancer will be a nice place to start.</p>
<p>With a binary search, you start in the middle.  If the check is good you move
halfway between the last probe point and the end of the path and check there.
If the check was bad, move halfway between the start of the path and where
you just probed.  Even after the first probe, you have ruled out half of the
path.</p>
<p>So in this example, you could do a tcpdump on the incoming interface of the
haproxy server.  You can have the client test again.  If you don’t see the
packets making it to the haproxy server, you can rule out the haproxy server,
nginx webheads, php-fpm app servers and the db.  You no know that you will
need to contact whoever is in charge of the router and switch(usually “netsec”),
and have them check for packets on either side of the router.</p>
</div>
<div class="section" id="troubleshooting-an-unknown-system-by-following-the-path">
<h2>Troubleshooting an Unknown System by Following the Path<a class="headerlink" href="#troubleshooting-an-unknown-system-by-following-the-path" title="Permalink to this headline">¶</a></h2>
<p>Many times when you are working support for larger companies that have many
accounts, you have no clue what the communication path is.  I see lower level
techs get into a system during a call or ticket and just assume that its using
a server because the customer said it was there or the server was associated
with a ticket.  Do NOT trust the customer and do NOT trust the ticket.  This
can lead to a goose chase and many wasted hours.  Many times it can even lead
to breaking a good system while troubleshooting the wrong path.</p>
<p>When this is the situation get good information from the customer and take
notes while following the communications path.  When I say good information
“I can’t hit my betterdildos.com site” won’t cut it.  Find out where they
are connecting from and get them to put in the full url they are trying to
hit.  Maybe they are typing in htttps://betterdildos.com and problem solved
as they think the tripple ttt works better because they are ocd.</p>
<p>Lets say that its the same system as the binary section, but we don’t know
that yet. So what is the first thing that happens when you type in a url
in the browser?  The hostname needs translated into an ip address.  So
the first step should be to do a dns query using something like dig to
get the ip address of the server.</p>
<p>We get the ip address from a dns query and use internal tools to see what device
has that ip. In this instance its a public virutal ip attached to a router. We
now have the first leg of the communication path.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>client browser &lt;=&gt; dc router
</pre></div>
</div>
<p>We don’t have access to the router, so we call netsec.  They take 30 minutes to
look up configs and see that its natted back to the internal ip address of a
server.  We log into the box and see that its a small server running an hapxory
software load balancer. We know that https means port 443 if you know your basic
port numbers.  We can use something like ss and netstat to see what application
is answering to port 443 on that ip address. You now know the next step in the
path.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>client browser &lt;=&gt; dc router &lt;=&gt; switch &lt;=&gt; haproxy server(haproxy service port 443)
</pre></div>
</div>
<p>You may not know what haproxy is.  A good start for any service is to look in
/etc/&lt;servicename&gt; for it.  We get lucky and see an haproxy config file. After
digging through it, you see the defination for the frontend and see that it goes
to 2 nginx servers on the backend on port 80.  We log into the devices and with
an ss or netstat, we see nginx is listening on those ports. We now know the next
paths that are taken.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>client browser &lt;=&gt; dc router &lt;=&gt; switch &lt;=&gt; haproxy server(haproxy service port 443) &lt;=&gt; (nginx1:80, nginx2:80)
</pre></div>
</div>
<p>We can now log into those servers and check the nginx config to see where the
next set of hops is going to be.  In this case, we see that nginx has a config
for betterdildos.com which has a backend balanced between 4 boxes on port 80. We
log into them and see that php-fpm is listening on port 80.  We now know the
next hop.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>client browser &lt;=&gt; dc router &lt;=&gt; switch &lt;=&gt; haproxy server(haproxy service port 443) &lt;=&gt; (nginx[1-2]:80) &lt;=&gt; (php-fpm[1-4]:80)
</pre></div>
</div>
<p>If you have been doing this a while, almost all applications utlize some sort of
database. You might be able to look for a php config or grep through the code
for a db config.  You can also use netstat for connections to things like port
3306 for mysql connections.  We now know the last leg of the path(mostly). We
really have no idea what custome code running on those php-fpm boxes are doing,
so it could be communicating out to several other places.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>client browser &lt;=&gt; dc router &lt;=&gt; switch &lt;=&gt; haproxy server(haproxy service port 443) &lt;=&gt; (nginx[1-2]:80) &lt;=&gt; (php-fpm[1-4]:80) &lt;=&gt; db
</pre></div>
</div>
<p>So you have a good idea of what the communication path is.  You can speed things
up by testing each of the path points while learning them.  This is good if you
have an angry customer on the line.  If its a minor issue where time can be taken,
it might pay to learn the system first then come up with a plan.  Either way, the
most important thing to do is take some notes.  You may find yourself in a serious
rabbit hole where something is going through 40+ hops.  Remembering something like
that is close to impossible.  You can reference the notes taken on each hop if
needed.  This is also really good to put in tickets or notes on an account as it
can help the next admin to get up to speed on the environment much quicker.</p>
<p>It might looks something like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>- customer has issues accessing http://betterdildos.com

- dig output showing betterdildos.com going to ip 123.123.123.123

- internal tool shows 123.123.123.123 goes to routerX

- contacted netsec and 123.123.123.123 is natted to internal address 172.172.172.172

- 172.172.172.172 is a linux box with id if 12345 with haproxy listening on 172.172.172.172:443

- haproxy output showing config for 172.172.172.172:443 balancing to 10.0.0.1:80, 10.0.0.2:80
  Saw 500 errors in the haproxy logs during testing.

- 10.0.0.1:80 and 10.0.0.1:80 are running nginx with betterdildos.com going to 10.0.0.3:80, 10.0.0.4:80, 10.0.0.5:80, 10.0.0.6:80
  Nginx servers up and running.  Seeing 500 erros in the logs from php-ftp services.

- 10.0.0.3:80, 10.0.0.4:80, 10.0.0.5:80, 10.0.0.6:80 are running the customers code on php-fpm
  php-fpm logs showing database connectivity ussues. Checked netstat output and saw several connecitons to 10.0.0.100:3306 in a bad state

- 10.0.0.100 looks like a mysql db.
  After running some tests, it looks like we hit the max connection limit.
</pre></div>
</div>
<p>From this info, you can see that following the path took you exactly where you
needed to be to find the issue.  Any admin coming in behind you can take this
and know exactly what is going on if further action is needed. It may seem like
this is lengthy and unneeded, but it will keep you from going on a goose chase
that can cause more problems than you started with.  It will also give you the
confidence to know exactly what the root of the issue is when talking to a
customer or manager.  Many admins starting out will guess based on past
experience and try some random troubleshooting steps until they stumble across
the root cause or guess at it without any real proof.</p>
<p>Also if you follow the path, you start seeing patterns.  Most systems no matter
what software they are running, follow some general guidelines.  Once you start
seeing what these patterns are, learning new systems can be a breeze.  Once you
know the big picture, getting the details for each probe point can be a man page
or google search away.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://en.wikipedia.org/wiki/Aphantasia">Aphantasia</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="https://en.wikipedia.org/wiki/Binary_search_algorithm">Binary Search</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../openstackdocs/index.html" title="Openstack Related Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Linux Related Documentation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MerlinTechs</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Linux Related Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Shannon Mitchell.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>